include header

script(type='text/javascript', src='/nowjs/now.js')

script
  var channels = [];
  var active_channel = null;
  
script
  now.join_channel = function(nickname, channel) {
    if (new Number(now.core.clientId).toString(36) == nickname) {
      var message = $('<p></p>').html('You joined ' + channel);
      join_channel(channel);
    } else {
      var message = $('<p></p>').html(nickname + ' joined ' + channel);
    }
    
    $('#' + channel).prepend(message);
  };
  
  now.get_message = function(nickname, channel, text) {
    if (new Number(now.core.clientId).toString(36) == nickname) {
      var message = $('<p></p>').html('&lt;you&gt; ' + text);
    } else {
      var message = $('<p></p>').html('&lt;' + nickname + '&gt; ' + text);
    }
    
    $('#' + channel).prepend(message);
  };

  now.ready(function() {
    
  });
  
  function send_message() {
    now.send_message(active_channel, $('#msg').val());
    $('#msg').val('');
    return false;
  }
  
  function join_channel(channel) {
    add_tab(channel);
    switch_channel(channel);
  }
  
  function add_tab(channel) {
    var tab = $('<li><a></a></li>');
    tab.addClass('active');
    tab.addClass(channel);
    $('a', tab).html(channel);
    
    tab.click(function() {
      switch_channel($('a', this).text());    
    });
    
    $('.tabs li').removeClass('active');
    $('.tabs').append(tab);
  }
  
  function switch_channel(channel) {
    active_channel = channel;
    $('.chat').hide();
    
    if ($('#' + channel).length > 0) {
      $('#' + channel).show();
    } else {
      var chan = $('<div />');
      chan.attr('id', channel);
      chan.addClass('chat');
      $('#chats').append(chan);
    }
    
    $('.tabs li').removeClass('active');
    $('.tabs li.' + channel).addClass('active');
  }

div#chatContainer.row
    ul.tabs
    div#chats.span10.columns
      div#main.chat
        p Welcome to Ragechat!
    div#users.span6.columns
    div#message
      input(type='text', id='msg', placeholder='Type a message', required, )   
      input.btn.small(type='button', value='Send', onclick='send_message()')
    div#nickname
      input(type='text', placeholder='Choose a nickname', required)   
      input.btn.small.primary(type='submit', value='Set nickname')

script
    $("#msg").keyup(function(event){
      if(event.keyCode == 13){
        send_message();
      }
    });
